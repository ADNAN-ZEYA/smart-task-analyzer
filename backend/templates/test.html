<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        button { margin: 10px 5px; padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; }
        button:hover { background: #0056b3; }
        .clear-btn { background: #dc3545; }
        .clear-btn:hover { background: #c82333; }
        textarea { width: 100%; height: 500px; margin-top: 10px; font-family: monospace; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .header { margin-bottom: 20px; }
        h1 { color: #333; }
    </style>
</head>
<body>
    <div class="header">
        <h1>ðŸ§ª Smart Task Manager - API Test</h1>
        <p>Use these buttons to test API endpoints and see full response details</p>
    </div>
    
    <div>
        <button onclick="testHealth()">1. Check API Health</button>
        <button onclick="testRegister()">2. Register testuser</button>
        <button onclick="testLogin()">3. Login testuser</button>
        <button onclick="testTaskList()">4. Get Task List</button>
        <button class="clear-btn" onclick="clearOutput()">Clear Output</button>
    </div>
    
    <h3>Response Output:</h3>
    <textarea id="output" placeholder="Response will appear here..."></textarea>
    
    <script>
        const API_URL = 'http://localhost:8000/api';
        
        function log(msg) {
            const output = document.getElementById('output');
            output.value += msg + '\n';
            output.scrollTop = output.scrollHeight;
        }
        
        function clearOutput() {
            document.getElementById('output').value = '';
        }
        
        async function testHealth() {
            clearOutput();
            log('=== Testing Health Check ===');
            log('GET /api/health/\n');
            try {
                const response = await fetch(`${API_URL}/health/`);
                log(`Status: ${response.status} ${response.statusText}`);
                const data = await response.json();
                log('\nResponse Body:');
                log(JSON.stringify(data, null, 2));
            } catch (e) {
                log(`Error: ${e.message}`);
            }
        }
        
        async function testRegister() {
            clearOutput();
            log('=== Testing Register ===');
            const payload = {
                username: 'testuser',
                password: 'testpass123',
                email: 'test@example.com'
            };
            log('POST /api/auth/register/');
            log('Request Body:');
            log(JSON.stringify(payload, null, 2));
            log('---');
            try {
                const response = await fetch(`${API_URL}/auth/register/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                log(`Status: ${response.status} ${response.statusText}`);
                const data = await response.json();
                log('\nResponse Body:');
                log(JSON.stringify(data, null, 2));
            } catch (e) {
                log(`Error: ${e.message}`);
            }
        }
        
        async function testLogin() {
            clearOutput();
            log('=== Testing Login ===');
            const payload = {
                username: 'testuser',
                password: 'testpass123'
            };
            log('POST /api/auth/login/');
            log('Request Body:');
            log(JSON.stringify(payload, null, 2));
            log('---');
            try {
                const response = await fetch(`${API_URL}/auth/login/`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                log(`Status: ${response.status} ${response.statusText}`);
                const data = await response.json();
                log('\nResponse Body:');
                log(JSON.stringify(data, null, 2));
                
                if (response.status === 200 && data.tokens) {
                    log('\nâœ… Login successful! Tokens saved.');
                    localStorage.setItem('access_token', data.tokens.access);
                    localStorage.setItem('refresh_token', data.tokens.refresh);
                }
            } catch (e) {
                log(`Error: ${e.message}`);
            }
        }
        
        async function testTaskList() {
            clearOutput();
            log('=== Testing Task List ===');
            const token = localStorage.getItem('access_token');
            log('GET /api/tasks/');
            log(`Authorization: Bearer ${token ? token.substring(0, 20) + '...' : 'NOT FOUND'}\n`);
            try {
                const headers = { 'Content-Type': 'application/json' };
                if (token) {
                    headers['Authorization'] = `Bearer ${token}`;
                }
                
                const response = await fetch(`${API_URL}/tasks/`, {
                    method: 'GET',
                    headers: headers
                });
                log(`Status: ${response.status} ${response.statusText}`);
                const data = await response.json();
                log('\nResponse Body:');
                log(JSON.stringify(data, null, 2));
            } catch (e) {
                log(`Error: ${e.message}`);
            }
        }
    </script>
</body>
</html>
